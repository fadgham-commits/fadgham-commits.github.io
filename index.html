<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>Arc Shift</title>
  <style>
    :root {
      color-scheme: dark;
      --bg: #0b0f14;
      --fg: #e8f1ff;
      --accent: #56ccf2;
      --accent2: #f2994a;
      --danger: #ff4d6d;
      --good: #7bd389;
      --ui: #121821;
    }
    html, body {
      margin: 0;
      height: 100%;
      background: radial-gradient(1200px circle at 50% 50%, #10151d, var(--bg));
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color: var(--fg);
      overflow: hidden;
    }
    #wrap {
      position: fixed; inset: 0; display: grid; grid-template-rows: auto 1fr auto;
    }
    header, footer {
      display: flex; align-items: center; justify-content: space-between;
      padding: 10px 14px; background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.08));
      backdrop-filter: blur(4px);
    }
    header h1 { margin: 0; font-size: 16px; letter-spacing: 0.5px; color: #cfe2ff; }
    .btns { display: flex; gap: 8px; }
    button {
      appearance: none; border: 1px solid #273244; color: var(--fg);
      background: #121821; padding: 8px 10px; border-radius: 10px; font-weight: 600;
      cursor: pointer; transition: transform .06s ease, background .2s ease, border-color .2s ease;
    }
    button:active { transform: scale(0.98); }
    button.primary { background: #162235; border-color: #2c3b52; }
    button.warn { background: #1d1418; border-color: #3e2430; color: #ffb3c1; }
    #hud { display: flex; gap: 12px; align-items: center; font-variant-numeric: tabular-nums; }
    #hud .pill { background: #121821; border: 1px solid #273244; border-radius: 999px; padding: 6px 10px; }
    #canvas { width: 100vw; height: calc(100vh - 96px); touch-action: none; display: block; }
    #overlay {
      position: absolute; inset: 60px 0 60px 0; display: grid; place-items: center; pointer-events: none;
    }
    .center-card {
      background: rgba(0,0,0,.35); border: 1px solid #273244; border-radius: 14px; padding: 18px 16px;
      min-width: 280px; max-width: 520px; backdrop-filter: blur(5px);
      text-align: center; pointer-events: auto;
    }
    .title { font-size: 20px; margin: 0 0 10px 0; color: #cfe2ff; }
    .muted { opacity: .8; font-size: 13px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 12px; }
    .k { color: #9fb2ca; }
    /* Mobile controls */
    #mobile {
      position: absolute; inset: 0; pointer-events: none;
    }
    .joy {
      position: absolute; bottom: 90px; left: 20px; width: 120px; height: 120px;
      border-radius: 50%; border: 2px dashed #273244; background: rgba(18,24,33,.35);
      pointer-events: auto; touch-action: none;
    }
    .nub {
      position: absolute; width: 56px; height: 56px; border-radius: 50%;
      background: #1b2536; border: 2px solid #2c3b52; left: 32px; top: 32px;
    }
    .dash {
      position: absolute; bottom: 90px; right: 20px; width: 88px; height: 88px; border-radius: 14px;
      background: #1b2536; border: 2px solid #2c3b52; pointer-events: auto; touch-action: manipulation;
      display: grid; place-items: center; font-weight: 700; color: #cfe2ff;
    }
    @media (min-width: 860px) {
      #mobile { display: none; }
      #canvas { height: calc(100vh - 80px); }
      header, footer { padding: 10px 18px; }
    }
  </style>
</head>
<body>
  <div id="wrap">
    <header>
      <h1>Arc Shift</h1>
      <div class="btns">
        <button id="start" class="primary">Mainkan</button>
        <button id="pause">Pause</button>
        <button id="mute">Mute</button>
        <button id="low">Low-power</button>
      </div>
      <div id="hud">
        <div class="pill">Skor: <span id="score">0</span></div>
        <div class="pill">Multi: <span id="multi">1.0x</span></div>
        <div class="pill">Waktu: <span id="time">0.0s</span></div>
      </div>
    </header>

    <canvas id="canvas"></canvas>

    <footer>
      <div class="muted">WASD/Arrows gerak, Shift/Space dash, P pause. Mobile: joystick + tombol Dash.</div>
      <div class="muted">© 2025 Arc Shift</div>
    </footer>
  </div>

  <div id="overlay" aria-hidden="true">
    <div class="center-card" id="card">
      <h2 class="title">Selamat datang di Arc Shift</h2>
      <p>Gerakkan inti, kumpulkan orbs, hindari proyektil. Gunakan Dash untuk iframe singkat dan tembus pola.</p>
      <div class="grid">
        <div>
          <div class="k">Gerak</div>
          <div>WASD / Arrows • Joystick</div>
        </div>
        <div>
          <div class="k">Dash</div>
          <div>Shift / Space • Tombol Dash</div>
        </div>
      </div>
      <p class="muted">Tekan “Mainkan” untuk mulai.</p>
    </div>
  </div>

  <div id="mobile">
    <div class="joy" id="joy"><div class="nub" id="nub"></div></div>
    <div class="dash" id="dashBtn">DASH</div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d', { alpha: false });
  const startBtn = document.getElementById('start');
  const pauseBtn = document.getElementById('pause');
  const muteBtn = document.getElementById('mute');
  const lowBtn = document.getElementById('low');
  const scoreEl = document.getElementById('score');
  const multiEl = document.getElementById('multi');
  const timeEl = document.getElementById('time');
  const overlay = document.getElementById('overlay');
  const card = document.getElementById('card');

  const joy = document.getElementById('joy');
  const nub = document.getElementById('nub');
  const dashBtn = document.getElementById('dashBtn');

  // Resize to device pixel ratio for crisp visuals
  const DPR = Math.min(window.devicePixelRatio || 1, 2);
  const state = {
    running: false,
    paused: false,
    muted: false,
    lowPower: false,
    w: 0, h: 0,
    t: 0, last: 0,
    score: 0, time: 0, multi: 1,
    player: null,
    bullets: [],
    orbs: [],
    particles: [],
    input: { up:0, down:0, left:0, right:0, dash:0, mvx:0, mvy:0 },
    spawn: { bulletTimer: 0, orbTimer: 0, level: 1, accel: 0.0009 },
  };

  function resize() {
    const rect = canvas.getBoundingClientRect();
    state.w = Math.floor(rect.width * DPR);
    state.h = Math.floor(rect.height * DPR);
    canvas.width = state.w;
    canvas.height = state.h;
  }
  resize();
  window.addEventListener('resize', resize);

  // Simple synth SFX
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  let ac = null;
  function ping(freq=440, time=0.08, gain=0.06){
    if (state.muted) return;
    if (!ac) ac = new AudioCtx();
    const o = ac.createOscillator();
    const g = ac.createGain();
    o.type = 'sine';
    o.frequency.value = freq;
    g.gain.value = gain;
    o.connect(g); g.connect(ac.destination);
    o.start();
    o.stop(ac.currentTime + time);
  }
  function click(freq=220, time=0.04, gain=0.05){
    if (state.muted) return;
    if (!ac) ac = new AudioCtx();
    const o = ac.createOscillator();
    const g = ac.createGain();
    o.type = 'triangle';
    o.frequency.setValueAtTime(freq, ac.currentTime);
    g.gain.setValueAtTime(gain, ac.currentTime);
    g.gain.exponentialRampToValueAtTime(0.0001, ac.currentTime + time);
    o.connect(g); g.connect(ac.destination);
    o.start();
    o.stop(ac.currentTime + time);
  }

  // Entities
  function makePlayer() {
    return {
      x: state.w/2, y: state.h/2, r: 10,
      vx: 0, vy: 0,
      speed: 0.24 * DPR,
      dash: { cd: 0, time: 0, dur: 160, cdMax: 1200, boost: 2.3, iframe: 120 },
      alive: true,
    };
  }
  function spawnBullet() {
    const edge = Math.floor(Math.random()*4); // 0 top, 1 right, 2 bottom, 3 left
    const margin = 20 * DPR;
    let x=0,y=0,vx=0,vy=0;
    const base = 0.11 * DPR + (state.spawn.level*0.007);
    if (edge===0){ x=Math.random()*state.w; y=margin; vx=0; vy=base; }
    if (edge===1){ x=state.w-margin; y=Math.random()*state.h; vx=-base; vy=0; }
    if (edge===2){ x=Math.random()*state.w; y=state.h-margin; vx=0; vy=-base; }
    if (edge===3){ x=margin; y=Math.random()*state.h; vx=base; vy=0; }
    const size = 6*DPR + Math.random()*4*DPR;
    state.bullets.push({ x,y,vx,vy,r:size, wobb: Math.random()*Math.PI*2, spin:(Math.random()<0.5?1:-1)*0.002 });
  }
  function spawnOrb() {
    const r = 6*DPR;
    const x = r + Math.random()*(state.w - 2*r);
    const y = r + Math.random()*(state.h - 2*r);
    state.orbs.push({ x, y, r, life: 6000, pulse: Math.random()*Math.PI*2 });
  }
  function addParticles(x,y,color,count=12,spread=1){
    for (let i=0;i<count;i++){
      const a = Math.random()*Math.PI*2, sp = (0.08+Math.random()*0.08)*DPR*spread;
      state.particles.push({ x, y, vx: Math.cos(a)*sp, vy: Math.sin(a)*sp, life: 500 + Math.random()*400, color });
    }
  }

  // Input
  const keys = new Set();
  window.addEventListener('keydown', (e) => {
    if (e.code==='KeyP'){ togglePause(); return; }
    keys.add(e.code);
    if (e.code==='Space' || e.code==='ShiftLeft' || e.code==='ShiftRight'){ state.input.dash = 1; }
  });
  window.addEventListener('keyup', (e) => {
    keys.delete(e.code);
  });

  // Mobile joystick
  let joyActive=false, joyStart=null;
  joy.addEventListener('pointerdown', (e)=>{ joyActive=true; joyStart={ x:e.clientX, y:e.clientY }; });
  joy.addEventListener('pointermove', (e)=>{
    if (!joyActive) return;
    const dx = e.clientX - joyStart.x;
    const dy = e.clientY - joyStart.y;
    const max = 40;
    const clampedX = Math.max(-max, Math.min(max, dx));
    const clampedY = Math.max(-max, Math.min(max, dy));
    nub.style.transform = `translate(${clampedX}px, ${clampedY}px)`;
    state.input.mvx = clampedX/max;
    state.input.mvy = clampedY/max;
  });
  joy.addEventListener('pointerup', ()=>{ joyActive=false; nub.style.transform = 'translate(0px,0px)'; state.input.mvx=0; state.input.mvy=0; });
  dashBtn.addEventListener('click', ()=> { state.input.dash = 1; });

  // Controls
  startBtn.addEventListener('click', startGame);
  pauseBtn.addEventListener('click', togglePause);
  muteBtn.addEventListener('click', ()=>{ state.muted=!state.muted; muteBtn.textContent = state.muted? 'Unmute':'Mute'; click(180); });
  lowBtn.addEventListener('click', ()=>{ state.lowPower=!state.lowPower; lowBtn.textContent = state.lowPower? 'High-power':'Low-power'; });

  function startGame(){
    overlay.style.display = 'none';
    state.running = true; state.paused = false;
    state.score=0; state.time=0; state.multi=1; state.spawn.level=1;
    state.bullets.length=0; state.orbs.length=0; state.particles.length=0;
    state.player = makePlayer();
    for (let i=0;i<4;i++) spawnOrb();
    click(240);
    state.last = performance.now();
    requestAnimationFrame(loop);
  }
  function togglePause(){
    if (!state.running) return;
    state.paused = !state.paused;
    pauseBtn.textContent = state.paused ? 'Resume' : 'Pause';
    if (!state.paused) { state.last = performance.now(); requestAnimationFrame(loop); }
  }

  // Collision helpers
  function circleHit(a, b){
    const dx = a.x - b.x, dy = a.y - b.y;
    const rr = a.r + b.r;
    return dx*dx + dy*dy <= rr*rr;
  }

  // Update
  function loop(now){
    if (!state.running || state.paused) return;
    const dt = Math.min(32, now - state.last);
    state.last = now;
    state.t += dt;
    state.time += dt/1000;

    // Difficulty scaling
    state.spawn.level += state.spawn.accel * dt;
    multiEl.textContent = `${state.multi.toFixed(1)}x`;
    timeEl.textContent = `${state.time.toFixed(1)}s`;

    // Player input
    const p = state.player;
    const up = keys.has('KeyW') || keys.has('ArrowUp') ? 1 : 0;
    const down = keys.has('KeyS') || keys.has('ArrowDown') ? 1 : 0;
    const left = keys.has('KeyA') || keys.has('ArrowLeft') ? 1 : 0;
    const right = keys.has('KeyD') || keys.has('ArrowRight') ? 1 : 0;
    const dx = right - left + state.input.mvx;
    const dy = down - up + state.input.mvy;

    const speed = p.speed * (state.lowPower ? 0.85 : 1.0);
    p.vx = dx * speed * dt;
    p.vy = dy * speed * dt;

    // Dash
    if (state.input.dash && p.dash.cd<=0){
      state.input.dash = 0;
      p.dash.time = p.dash.dur;
      p.dash.cd = p.dash.cdMax;
      state.multi = Math.min(5, state.multi + 0.1);
      ping(620, 0.06, 0.05);
      addParticles(p.x, p.y, '#56ccf2', 20, 1.5);
    }
    if (p.dash.cd>0) p.dash.cd -= dt;
    if (p.dash.time>0){
      const boost = p.dash.boost;
      p.x += p.vx * boost;
      p.y += p.vy * boost;
      p.dash.time -= dt;
    } else {
      p.x += p.vx;
      p.y += p.vy;
    }

    // Bounds
    p.x = Math.max(p.r, Math.min(state.w - p.r, p.x));
    p.y = Math.max(p.r, Math.min(state.h - p.r, p.y));

    // Spawn bullets/orbs
    state.spawn.bulletTimer -= dt;
    state.spawn.orbTimer -= dt;
    if (state.spawn.bulletTimer <= 0){
      const burst = Math.floor(1 + state.spawn.level*0.25);
      for (let i=0;i<burst;i++) spawnBullet();
      state.spawn.bulletTimer = Math.max(180, 900 - state.spawn.level*120);
    }
    if (state.spawn.orbTimer <= 0){
      spawnOrb();
      state.spawn.orbTimer = Math.max(1000, 3000 - state.spawn.level*160);
    }

    // Update bullets
    for (let i=state.bullets.length-1; i>=0; i--){
      const b = state.bullets[i];
      b.x += b.vx * dt; b.y += b.vy * dt;
      b.wobb += b.spin * dt;
      b.x += Math.cos(b.wobb) * 0.02 * dt;
      b.y += Math.sin(b.wobb) * 0.02 * dt;
      // remove if out
      if (b.x<-40 || b.x>state.w+40 || b.y<-40 || b.y>state.h+40) state.bullets.splice(i,1);
    }

    // Update orbs
    for (let i=state.orbs.length-1; i>=0; i--){
      const o = state.orbs[i];
      o.pulse += dt * 0.006;
      o.life -= dt;
      if (circleHit({x:p.x,y:p.y,r:p.r}, o)){
        state.score += Math.floor(10 * state.multi);
        scoreEl.textContent = state.score;
        ping(760, 0.05, 0.05);
        addParticles(o.x, o.y, '#7bd389', 12, 1.0);
        state.orbs.splice(i,1);
      } else if (o.life <= 0){
        state.orbs.splice(i,1);
      }
    }

    // Collision bullets
    if (p.dash.time<=p.dash.iframe){
      // brief iframe during dash end; reduce hitbox harshness
      // intentionally forgiving
    } else {
      for (let i=0;i<state.bullets.length;i++){
        const b = state.bullets[i];
        if (circleHit({x:p.x,y:p.y,r:p.r+1}, b)){
          gameOver();
          return;
        }
      }
    }

    // Particles
    for (let i=state.particles.length-1;i>=0;i--){
      const pa = state.particles[i];
      pa.x += pa.vx * dt; pa.y += pa.vy * dt;
      pa.life -= dt;
      if (pa.life<=0) state.particles.splice(i,1);
    }

    // Render
    render(dt);

    // Continue
    requestAnimationFrame(loop);
  }

  // Render
  function render(dt){
    // Background fade trail
    ctx.fillStyle = 'rgba(11,15,20,0.35)';
    ctx.fillRect(0,0,state.w,state.h);

    // Grid glow
    ctx.save();
    ctx.globalAlpha = 0.08;
    ctx.strokeStyle = '#273244';
    const step = 40 * DPR;
    ctx.beginPath();
    for (let x=0; x<=state.w; x+=step){
      ctx.moveTo(x,0); ctx.lineTo(x,state.h);
    }
    for (let y=0; y<=state.h; y+=step){
      ctx.moveTo(0,y); ctx.lineTo(state.w,y);
    }
    ctx.stroke();
    ctx.restore();

    // Orbs
    for (const o of state.orbs){
      const r = o.r + Math.sin(o.pulse)*2;
      const grad = ctx.createRadialGradient(o.x,o.y,1, o.x,o.y,r*2);
      grad.addColorStop(0, 'rgba(123,211,137,0.9)');
      grad.addColorStop(1, 'rgba(123,211,137,0.0)');
      ctx.fillStyle = grad;
      ctx.beginPath(); ctx.arc(o.x,o.y,r*2,0,Math.PI*2); ctx.fill();

      ctx.fillStyle = '#7bd389';
      ctx.beginPath(); ctx.arc(o.x,o.y,r,0,Math.PI*2); ctx.fill();
    }

    // Bullets
    for (const b of state.bullets){
      ctx.save();
      ctx.shadowColor = '#ff4d6d';
      ctx.shadowBlur = 12;
      ctx.fillStyle = '#ff4d6d';
      ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fill();
      ctx.restore();
    }

    // Player
    const p = state.player;
    ctx.save();
    const dashAlpha = p.dash.time>0 ? 0.12 : 0.06;
    ctx.fillStyle = `rgba(86,204,242,${dashAlpha})`;
    ctx.beginPath(); ctx.arc(p.x, p.y, p.r*3, 0, Math.PI*2); ctx.fill();
    ctx.shadowColor = '#56ccf2';
    ctx.shadowBlur = 14;
    ctx.fillStyle = '#cfe2ff';
    ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
    ctx.restore();

    // Particles
    for (const pa of state.particles){
      ctx.fillStyle = pa.color;
      ctx.globalAlpha = Math.max(0, Math.min(1, pa.life/800));
      ctx.fillRect(pa.x, pa.y, 2*DPR, 2*DPR);
    }

    // UI hints
    ctx.globalAlpha = 1;
    ctx.fillStyle = 'rgba(207,226,255,0.7)';
    ctx.font = `${12*DPR}px system-ui, sans-serif`;
    ctx.textAlign = 'left';
    ctx.fillText(`LV ${state.spawn.level.toFixed(1)}`, 12*DPR, 18*DPR);
    ctx.textAlign = 'right';
    ctx.fillText(`Bullets ${state.bullets.length}`, state.w-12*DPR, 18*DPR);
  }

  function gameOver(){
    state.running = false;
    overlay.style.display = 'grid';
    card.innerHTML = `
      <h2 class="title">Game Over</h2>
      <p>Skor kamu: <b>${state.score}</b> • Waktu: <b>${state.time.toFixed(1)}s</b> • Multi: <b>${state.multi.toFixed(1)}x</b></p>
      <p class="muted">Pencapaian kamu layak diacungi jempol. Mau coba lagi dan pecahkan rekor?</p>
      <div class="grid">
        <button class="primary" id="again">Main lagi</button>
        <button id="share">Copy skor</button>
      </div>
    `;
    document.getElementById('again').addEventListener('click', startGame);
    document.getElementById('share').addEventListener('click', ()=>{
      const txt = `Arc Shift — skor ${state.score}, waktu ${state.time.toFixed(1)}s, multi ${state.multi.toFixed(1)}x`;
      navigator.clipboard?.writeText(txt);
      click(300);
    });
    ping(120, 0.12, 0.06);
  }
})();
</script>
</body>
</html>
