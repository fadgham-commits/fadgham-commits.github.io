<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Blade Runner Arena++</title>
<style>
  body { margin:0; background:#111; color:#fff; font-family:sans-serif; }
  canvas { display:block; margin:0 auto; background:#222; }
  #hud { position:fixed; top:10px; left:50%; transform:translateX(-50%);
         width:80%; height:20px; border:2px solid #555; border-radius:6px; }
  #hpbar { height:100%; background:limegreen; border-radius:4px; }
</style>
</head>
<body>
<div id="hud"><div id="hpbar"></div></div>
<canvas id="game" width="800" height="600"></canvas>
<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const hpbar=document.getElementById("hpbar");

let player={x:400,y:300,r:15,hp:100,speed:4,bulletSize:5,bulletSpeed:20};
let enemies=[];
let bullets=[];
let heals=[];
let bosses=[];
let score=0;
let keys={};

document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);
canvas.addEventListener("click",shoot);

function shoot(e){
  bullets.push({x:player.x,y:player.y,r:player.bulletSize,
                vx:(e.offsetX-player.x)/player.bulletSpeed,
                vy:(e.offsetY-player.y)/player.bulletSpeed});
}

function spawnEnemy(){
  let side=Math.floor(Math.random()*4);
  let x,y;
  if(side===0){x=Math.random()*800;y=0;}
  if(side===1){x=800;y=Math.random()*600;}
  if(side===2){x=Math.random()*800;y=600;}
  if(side===3){x=0;y=Math.random()*600;}
  enemies.push({x,y,r:12,speed:2});
}

function spawnHeal(){
  let x=Math.random()*760+20;
  let y=Math.random()*560+20;
  heals.push({x,y,r:10});
}

function spawnBoss(){
  bosses.push({x:Math.random()*800,y:Math.random()*600,r:30,hp:50,speed:1.5});
}

function update(){
  // player movement
  if(keys["w"]||keys["ArrowUp"]) player.y-=player.speed;
  if(keys["s"]||keys["ArrowDown"]) player.y+=player.speed;
  if(keys["a"]||keys["ArrowLeft"]) player.x-=player.speed;
  if(keys["d"]||keys["ArrowRight"]) player.x+=player.speed;

  player.x=Math.max(player.r,Math.min(800-player.r,player.x));
  player.y=Math.max(player.r,Math.min(600-player.r,player.y));

  // enemies move toward player
  for(let e of enemies){
    let dx=player.x-e.x,dy=player.y-e.y;
    let dist=Math.hypot(dx,dy);
    e.x+=e.speed*dx/dist;
    e.y+=e.speed*dy/dist;
    if(dist<player.r+e.r){
      player.hp-=1;
      if(player.hp<=0){alert("Game Over! Skor: "+score);document.location.reload();}
    }
  }

  // bosses move toward player
  for(let b of bosses){
    let dx=player.x-b.x,dy=player.y-b.y;
    let dist=Math.hypot(dx,dy);
    b.x+=b.speed*dx/dist;
    b.y+=b.speed*dy/dist;
    if(dist<player.r+b.r){
      player.hp-=2;
      if(player.hp<=0){alert("Game Over! Skor: "+score);document.location.reload();}
    }
  }

  // bullets
  for(let b of bullets){
    b.x+=b.vx; b.y+=b.vy;
  }

  // bullet-enemy collision
  for(let i=enemies.length-1;i>=0;i--){
    for(let j=bullets.length-1;j>=0;j--){
      let dx=enemies[i].x-bullets[j].x;
      let dy=enemies[i].y-bullets[j].y;
      let dist=Math.hypot(dx,dy);
      if(dist<enemies[i].r+bullets[j].r){
        enemies.splice(i,1);
        bullets.splice(j,1);
        score+=50;
        break;
      }
    }
  }

  // bullet-boss collision
  for(let i=bosses.length-1;i>=0;i--){
    for(let j=bullets.length-1;j>=0;j--){
      let dx=bosses[i].x-bullets[j].x;
      let dy=bosses[i].y-bullets[j].y;
      let dist=Math.hypot(dx,dy);
      if(dist<bosses[i].r+bullets[j].r){
        bosses[i].hp-=5;
        bullets.splice(j,1);
        if(bosses[i].hp<=0){
          bosses.splice(i,1);
          score+=500;
        }
        break;
      }
    }
  }

  // heal spawn
  if(Math.random()<0.005) spawnHeal();

  // heal pickup
  for(let i=heals.length-1;i>=0;i--){
    let dx=player.x-heals[i].x;
    let dy=player.y-heals[i].y;
    let dist=Math.hypot(dx,dy);
    if(dist<player.r+heals[i].r){
      player.hp=Math.min(100,player.hp+20);
      heals.splice(i,1);
    }
  }

  // spawn new enemies
  if(Math.random()<0.02) spawnEnemy();

  // spawn boss tiap skor 1000
  if(score>0 && score%1000===0 && bosses.length===0) spawnBoss();

  // upgrade senjata tiap 500 skor
  if(score>0 && score%500===0){
    player.bulletSize+=1;
    player.bulletSpeed=Math.max(10,player.bulletSpeed-2);
  }

  score++;
}

function draw(){
  ctx.clearRect(0,0,800,600);
  // player
  ctx.fillStyle="cyan";
  ctx.beginPath();ctx.arc(player.x,player.y,player.r,0,Math.PI*2);ctx.fill();

  // enemies
  ctx.fillStyle="red";
  for(let e of enemies){
    ctx.beginPath();ctx.arc(e.x,e.y,e.r,0,Math.PI*2);ctx.fill();
  }

  // bosses
  ctx.fillStyle="purple";
  for(let b of bosses){
    ctx.beginPath();ctx.arc(b.x,b.y,b.r,0,Math.PI*2);ctx.fill();
    ctx.fillStyle="#fff";
    ctx.fillText("HP:"+b.hp,b.x-20,b.y-40);
    ctx.fillStyle="purple";
  }

  // bullets
  ctx.fillStyle="blue";
  for(let b of bullets){
    ctx.beginPath();ctx.arc(b.x,b.y,b.r,0,Math.PI*2);ctx.fill();
  }

  // heals
  ctx.fillStyle="lime";
  for(let h of heals){
    ctx.beginPath();ctx.arc(h.x,h.y,h.r,0,Math.PI*2);ctx.fill();
  }

  // score
  ctx.fillStyle="#fff";
  ctx.fillText("Skor: "+score,10,20);

  // hp bar
  hpbar.style.width=player.hp+"%";
  if(player.hp>60) hpbar.style.background="limegreen";
  else if(player.hp>30) hpbar.style.background="yellow";
  else hpbar.style.background="red";
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
